<view class="page">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-nav" style="padding-top: {{statusBarHeight}}px">
    <view class="nav-content">
      <view class="back-button" bindtap="onBackTap">
        <text class="back-icon">â†</text>
      </view>
      <text class="nav-title">æˆ‘çš„ç¬”è®°</text>
      <view class="placeholder"></view>
    </view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
  <view class="search-section" style="position: sticky; left: NaNrpx; top: 176rpx">
    <view class="search-bar">
      <view class="search-input-wrap">
        <text class="search-icon">ğŸ”</text>
        <input 
          class="search-input" 
          placeholder="æœç´¢ç¬”è®°å†…å®¹" 
          placeholder-class="search-placeholder"
          bindinput="onSearchInput"
          value="{{searchKeyword}}"
          confirm-type="search"
          bindconfirm="onSearch"
        />
        <view class="clear-button" bindtap="onClearSearch" wx:if="{{searchKeyword}}">
          <text class="clear-icon">Ã—</text>
        </view>
      </view>
    </view>
    
    <!-- ç­›é€‰æ ‡ç­¾ -->
    <scroll-view class="filter-tags" scroll-x enable-flex show-scrollbar="{{false}}">
      <view class="tag {{currentBookId === '' ? 'active' : ''}}" 
        bindtap="onTagTap" 
        data-id="">
        å…¨éƒ¨ç¬”è®°
      </view>
      <view class="tag {{currentBookId === book.id ? 'active' : ''}}" 
        wx:for="{{books}}" 
        wx:key="id"
        wx:for-item="book"
        bindtap="onTagTap"
        data-id="{{book.id}}">
        {{book.title}}
      </view>
    </scroll-view>
  </view>

  <!-- ç¬”è®°åˆ—è¡¨ -->
  <scroll-view 
    class="note-list" 
    scroll-y 
    enable-flex 
    enhanced 
    show-scrollbar="{{false}}"
    bindscrolltolower="onLoadMore"
  >
    <view class="note-list-content" style="position: relative; left: 0rpx; top: 88rpx">
      <block wx:if="{{filteredNotes.length > 0}}">
        <view class="note-card" 
          wx:for="{{filteredNotes}}" 
          wx:key="id"
          bindtap="onNoteTap"
          data-note="{{item}}"
        >
          <view class="note-header">
            <image class="book-cover" src="{{item.book.coverUrl}}" mode="aspectFill"></image>
            <view class="note-info">
              <text class="book-title">{{item.book.title}}</text>
              <text class="note-time">{{item.createTimeFormatted}}</text>
            </view>
          </view>
          <view class="note-content">{{item.content}}</view>
        </view>
      </block>
      <view wx:else class="empty-state">
        <view class="empty-icon">ğŸ“</view>
        <text class="empty-text">{{searchKeyword ? 'æœªæ‰¾åˆ°ç›¸å…³ç¬”è®°' : 'è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•ç¬”è®°'}}</text>
        <text class="empty-subtext">{{searchKeyword ? 'æ¢ä¸ªå…³é”®è¯è¯•è¯•å§' : 'å»é¦–é¡µæ·»åŠ ä½ çš„ç¬¬ä¸€æ¡ç¬”è®°'}}</text>
        <button wx:if="{{!searchKeyword}}" class="add-note-button" bindtap="onAddNote">å†™ç¬”è®°</button>
      </view>
    </view>
  </scroll-view>

  <!-- æ‚¬æµ®æ·»åŠ æŒ‰é’® -->
  <view class="fab-button" bindtap="onAddNote" wx:if="{{filteredNotes.length > 0}}">
    <text class="fab-icon">+</text>
  </view>
</view> 