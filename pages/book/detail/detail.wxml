<!--pages/book/detail/detail.wxml-->
<view class="page">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-nav" style="padding-top: {{statusBarHeight}}px">
    <view class="nav-content">
      <view class="back-button" bindtap="onBackTap">
        <text class="back-icon">â†</text>
      </view>
      <text class="nav-title">ä¹¦ç±è¯¦æƒ…</text>
      <view class="more-button" bindtap="showActionSheet">
        <text class="more-icon">â‹®</text>
      </view>
    </view>
  </view>

  <!-- ä¹¦ç±ä¿¡æ¯ -->
  <view class="book-info">
    <image class="book-cover" src="{{book.coverUrl}}" mode="aspectFill"></image>
    <view class="book-meta">
      <text class="book-title">{{book.title}}</text>
      <text class="book-author">{{book.author}}</text>
      <view class="book-stats">
        <view class="stat-item">
          <text class="stat-num">{{noteCount}}</text>
          <text class="stat-label">ç¬”è®°</text>
        </view>
        <view class="stat-item">
          <text class="stat-num">{{readingDays}}</text>
          <text class="stat-label">é˜…è¯»å¤©æ•°</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç¬”è®°åˆ—è¡¨ -->
  <view class="notes-section">
    <view class="section-header">
      <text class="section-title">é˜…è¯»ç¬”è®°</text>
      <view class="add-note" bindtap="showNoteOptions">
        <text class="add-icon">+</text>
        <text class="add-text">æ·»åŠ ç¬”è®°</text>
      </view>
    </view>

    <scroll-view class="note-list" scroll-y enable-flex enhanced show-scrollbar="{{false}}">
      <block wx:if="{{notes.length > 0}}">
        <view class="note-item" 
          wx:for="{{notes}}" 
          wx:key="id"
          bindtap="onNoteTap"
          data-note="{{item}}">
          <view class="note-type-icon">{{item.type === 'text' ? 'ğŸ“' : 'ğŸ™ï¸'}}</view>
          <view class="note-content">
            <text class="note-text" wx:if="{{item.type === 'text'}}">{{item.content}}</text>
            <view class="voice-info" wx:else>
              <text class="voice-duration">{{item.recordings[0].duration}}â€³ è¯­éŸ³ç¬”è®°</text>
            </view>
            <text class="note-time">{{item.createTimeFormatted}}</text>
          </view>
        </view>
      </block>
      <view wx:else class="empty-state">
        <view class="empty-icon">ğŸ“</view>
        <text class="empty-text">è¿˜æ²¡æœ‰æ·»åŠ ç¬”è®°</text>
        <text class="empty-subtext">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ ç¬¬ä¸€æ¡ç¬”è®°</text>
      </view>
    </scroll-view>
  </view>

  <!-- ç¬”è®°ç±»å‹é€‰æ‹©å¼¹çª— -->
  <view class="note-options {{showOptions ? 'show' : ''}}" bindtap="hideNoteOptions">
    <view class="options-content" catchtap="stopPropagation">
      <view class="option-item" bindtap="onAddTextNote">
        <view class="option-icon">ğŸ“</view>
        <view class="option-info">
          <text class="option-title">æ–‡å­—ç¬”è®°</text>
          <text class="option-desc">è®°å½•è¯»ä¹¦å¿ƒå¾—å’Œæ„Ÿæ‚Ÿ</text>
        </view>
      </view>
      <view class="option-item" bindtap="onAddVoiceNote">
        <view class="option-icon">ğŸ™ï¸</view>
        <view class="option-info">
          <text class="option-title">è¯­éŸ³ç¬”è®°</text>
          <text class="option-desc">ç”¨è¯­éŸ³å¿«é€Ÿè®°å½•æƒ³æ³•</text>
        </view>
      </view>
    </view>
  </view>
</view>